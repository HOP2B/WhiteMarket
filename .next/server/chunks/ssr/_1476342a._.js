module.exports=[27159,a=>a.a(async(b,c)=>{try{var d=a.i(8171),e=a.i(27669),f=a.i(41910),g=a.i(25259),h=a.i(71590),i=a.i(81176),j=a.i(76165),k=b([i,j]);[i,j]=k.then?(await k)():k,a.s(["default",0,()=>{let{user:a}=(0,h.useAuth)(),{contact:b}=(0,f.useRouter)().query,[c,k]=(0,e.useState)([]),[l,m]=(0,e.useState)(!0),[n,o]=(0,e.useState)(""),[p,q]=(0,e.useState)(null),[r,s]=(0,e.useState)({}),[t,u]=(0,e.useState)(null);(0,e.useEffect)(()=>{if(a){(async()=>{try{let b=await (0,i.getMessages)(a.id);k(b);let c=Array.from(new Set(b.map(b=>b.senderId===a.id?b.receiverId:b.senderId))),d=c.map(a=>(0,i.getUserById)(a)),e=await Promise.all(d),f={};e.forEach((a,b)=>{f[c[b]]=a}),s(f),m(!1)}catch(a){console.error("Error fetching messages:",a),m(!1)}})();let b=j.supabase.channel("messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},b=>{let c=b.new;(c.senderId===a.id||c.receiverId===a.id)&&k(a=>[...a,c])}).subscribe();return()=>{b.unsubscribe()}}},[a]),(0,e.useEffect)(()=>{b&&"string"==typeof b&&q(b)},[b]);let v=async()=>{if((n.trim()||t)&&a&&p)try{let b={id:Date.now().toString(),senderId:a.id,receiverId:p,content:n,timestamp:new Date().toISOString()};t&&(b.file={name:t.name,size:t.size,type:t.type,url:URL.createObjectURL(t)}),await (0,i.sendMessage)(b),k([...c,b]),o(""),u(null)}catch(a){console.error("Error sending message:",a)}},w=Array.from(new Set(c.map(b=>b.senderId===a?.id?b.receiverId:b.senderId)));return l?(0,d.jsx)("div",{className:"flex justify-center items-center h-screen",children:(0,d.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-green-600"})}):a?(0,d.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,d.jsx)(g.default,{}),(0,d.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,d.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-8",children:"Messages"}),(0,d.jsxs)("div",{className:"flex flex-col lg:flex-row gap-8",children:[(0,d.jsxs)("div",{className:"lg:w-1/4 bg-white rounded-lg shadow-md overflow-hidden",children:[(0,d.jsx)("div",{className:"p-4 border-b",children:(0,d.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Conversations"})}),(0,d.jsx)("div",{className:"divide-y divide-gray-200",children:w.map(b=>{let e=c.filter(c=>c.senderId===a?.id&&c.receiverId===b||c.senderId===b&&c.receiverId===a?.id),f=e[e.length-1],g=r[b];return(0,d.jsx)("div",{className:`p-4 cursor-pointer hover:bg-gray-50 ${p===b?"bg-gray-100":""}`,onClick:()=>q(b),children:(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)("img",{src:g?.avatar||"/default-avatar.jpg",alt:g?.name||"User",className:"w-10 h-10 rounded-full mr-3"}),(0,d.jsxs)("div",{className:"flex-1",children:[(0,d.jsx)("p",{className:"font-semibold text-gray-900",children:g?.name||`User ${b}`}),(0,d.jsx)("p",{className:"text-sm text-gray-500 truncate",children:f?.content})]})]})},b)})})]}),(0,d.jsxs)("div",{className:"lg:w-3/4 bg-white rounded-lg shadow-md",children:[(0,d.jsx)("div",{className:"p-4 border-b",children:(0,d.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Conversation"})}),(0,d.jsx)("div",{className:"p-4 h-96 overflow-y-auto",children:p?c.filter(b=>b.senderId===a.id&&b.receiverId===p||b.senderId===p&&b.receiverId===a.id).map(b=>(0,d.jsx)("div",{className:`mb-4 flex ${b.senderId===a.id?"justify-end":"justify-start"}`,children:(0,d.jsxs)("div",{className:`max-w-xs lg:max-w-md rounded-lg p-3 ${b.senderId===a.id?"bg-green-600 text-white":"bg-gray-200 text-gray-900"}`,children:[b.file&&(0,d.jsx)("div",{className:"mb-2",children:(0,d.jsxs)("div",{className:"bg-black bg-opacity-20 rounded p-2",children:[(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)("span",{className:"text-xs mr-2",children:"ðŸ“Ž"}),(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-xs font-medium",children:b.file.name}),(0,d.jsxs)("p",{className:"text-xs opacity-75",children:[(b.file.size/1024).toFixed(1)," KB"]})]})]}),b.file.type.startsWith("image/")&&(0,d.jsx)("img",{src:b.file.url,alt:b.file.name,className:"mt-2 max-w-full h-auto rounded",style:{maxHeight:"200px"}})]})}),b.content&&(0,d.jsx)("p",{className:"text-sm",children:b.content}),(0,d.jsx)("p",{className:`text-xs mt-1 ${b.senderId===a.id?"text-green-100":"text-gray-500"}`,children:new Date(b.timestamp).toLocaleTimeString()})]})},b.id)):(0,d.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,d.jsx)("p",{className:"text-gray-500",children:"Select a conversation to view messages"})})}),p&&(0,d.jsxs)("div",{className:"p-4 border-t",children:[t&&(0,d.jsxs)("div",{className:"mb-2 p-2 bg-gray-100 rounded flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)("span",{className:"text-sm mr-2",children:"ðŸ“Ž"}),(0,d.jsx)("span",{className:"text-sm",children:t.name})]}),(0,d.jsx)("button",{onClick:()=>u(null),className:"text-red-500 hover:text-red-700 text-sm",children:"âœ•"})]}),(0,d.jsxs)("div",{className:"flex gap-2",children:[(0,d.jsx)("input",{type:"text",value:n,onChange:a=>o(a.target.value),placeholder:"Ð—ÑƒÑ€Ð²Ð°Ñ Ð±Ð¸Ñ‡Ð½Ñ Ò¯Ò¯...",className:"flex-1 px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",onKeyPress:a=>"Enter"===a.key&&v()}),(0,d.jsxs)("label",{className:"cursor-pointer bg-gray-200 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-300 flex items-center",children:[(0,d.jsx)("span",{className:"mr-1",children:"ðŸ“Ž"}),(0,d.jsx)("input",{type:"file",onChange:a=>{let b=a.target.files?.[0];b&&u(b)},className:"hidden",accept:"image/*,.pdf,.doc,.docx,.txt"})]}),(0,d.jsx)("button",{onClick:v,disabled:!n.trim()&&!t,className:"bg-green-600 text-white px-6 py-2 rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Ð˜Ð»Ð³ÑÑÑ…"})]})]})]})]})]})]}):(0,d.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,d.jsx)(g.default,{}),(0,d.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,d.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Please login to view messages"})})]})}]),c()}catch(a){c(a)}},!1),81422,a=>a.a(async(b,c)=>{try{var d=a.i(79168),e=a.i(27068),f=a.i(32759),g=a.i(39141),h=a.i(67298),i=a.i(27159),j=a.i(9193),k=b([i]);[i]=k.then?(await k)():k;let l=(0,f.hoist)(i,"default"),m=(0,f.hoist)(i,"getStaticProps"),n=(0,f.hoist)(i,"getStaticPaths"),o=(0,f.hoist)(i,"getServerSideProps"),p=(0,f.hoist)(i,"config"),q=(0,f.hoist)(i,"reportWebVitals"),r=(0,f.hoist)(i,"unstable_getStaticProps"),s=(0,f.hoist)(i,"unstable_getStaticPaths"),t=(0,f.hoist)(i,"unstable_getStaticParams"),u=(0,f.hoist)(i,"unstable_getServerProps"),v=(0,f.hoist)(i,"unstable_getServerSideProps"),w=new d.PagesRouteModule({definition:{kind:e.RouteKind.PAGES,page:"/messages",pathname:"/messages",bundlePath:"",filename:""},distDir:".next",relativeProjectDir:"",components:{App:h.default,Document:g.default},userland:i}),x=(0,j.getHandler)({srcPage:"/messages",config:p,userland:i,routeModule:w,getStaticPaths:n,getStaticProps:m,getServerSideProps:o});a.s(["config",0,p,"default",0,l,"getServerSideProps",0,o,"getStaticPaths",0,n,"getStaticProps",0,m,"handler",0,x,"reportWebVitals",0,q,"routeModule",0,w,"unstable_getServerProps",0,u,"unstable_getServerSideProps",0,v,"unstable_getStaticParams",0,t,"unstable_getStaticPaths",0,s,"unstable_getStaticProps",0,r]),c()}catch(a){c(a)}},!1)];

//# sourceMappingURL=_1476342a._.js.map